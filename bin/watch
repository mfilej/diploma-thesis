#!/usr/bin/env bash

# Watches for changes to source files and fires rake.
# Requires fsevent_watch (brew install fsevent_watch).

set -e
set -u
set -o pipefail

watch() {
  fsevent_watch -F
}

match() {
  grep -v --line-buffered build | \
  grep -E --line-buffered "(\.md|figures|layout\.tex|bibliography\.bib)"
}

run() {
  xargs -I% -n1 sh -c "rake"
}

watch | match | run
